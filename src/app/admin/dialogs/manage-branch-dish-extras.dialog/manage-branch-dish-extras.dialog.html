<div style="width: min(700px, 90vw);">
  <h2 mat-dialog-title style="display: flex; align-items: center; gap: 12px;">
    <mat-icon>tune</mat-icon>
    <span>Plato en extras de la sede</span>
  </h2>
  <mat-dialog-content style="display: flex; flex-direction: column; gap: 16px;">
    <mat-card style="padding: 16px">
      <div style="display: flex; flex-direction: column; gap: 6px;">
        <span style="font-weight: 700; font-size: 18px;">{{ data.branchDish.dish.name }}</span>
        <span>{{ data.branchDish.dish.description }}</span>
        <div>
          <span>Categoría: <strong>{{ data.branchDish.dish.category.name }}</strong></span>
        </div>
      </div>
    </mat-card>
    @if (dataLoaded) {
      <div>
        <button matButton="filled" [disabled]="savingExtraBranchDish" (click)="onSaveExtraBranchDishes()">
          <mat-icon>save</mat-icon>
          <span>Guardar todos los cambios</span>
        </button>
      </div>
      <div style="overflow: auto;">
        <table mat-table [dataSource]="extraBranchDishes">
          <ng-container matColumnDef="extra">
            <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5;">Plato</th>
            <td mat-cell *matCellDef="let e">
              <div style="font-weight: 600;">{{ e.extraBranch.extra.name }}</div>
            </td>
          </ng-container>
          <ng-container matColumnDef="availability">
            <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5;">Disponibilidad</th>
            <td mat-cell *matCellDef="let e">
              <mat-chip (click)="onChangeAvailability(e)">
                <mat-icon matChipAvatar>{{ e.isAvailable ? 'check_circle' : e.id ? 'radio_button_unchecked' : 'radio_button_unchecked' }}</mat-icon>
                {{ e.isAvailable ? 'Disponible' : e.id ? 'No Disponible' : 'No agregado' }}
              </mat-chip>
            </td>
          </ng-container>
          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5;">Precio</th>
            <td mat-cell *matCellDef="let e">
              <mat-form-field appearance="outline" subscriptSizing="dynamic" style="margin-top: 8px; width: 150px">
                <mat-label>Opcional</mat-label>
                <span matTextPrefix>S/.&nbsp;</span>
                <input matInput type="number" min="0" [(ngModel)]="e.customPrice" (ngModelChange)="onExtraBranchDishChanged(e)"/>
                <mat-hint>Si lo dejas vacío, se usará {{ e.extraBranch.extra.basePrice }}</mat-hint>
              </mat-form-field>
            </td>
          </ng-container>
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef style="text-align: right; font-weight: 600; background: #f5f5f5;">Acciones</th>
            <td mat-cell *matCellDef="let e" class="bd-actions-cell">
              <button matButton="filled" [disabled]="!e.changed" (click)="onSaveExtraBranchDish(e)">
                <mat-icon>save</mat-icon>
                <span>Guardar cambios</span>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    } @else {
      <div style="display: flex; justify-content: center; margin: 10px 0">
        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      </div>
    }
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button mat-dialog-close [disabled]="savingExtraBranchDish">Cerrar</button>
  </mat-dialog-actions>
</div>
